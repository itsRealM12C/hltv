<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live TVz</title>
    <link rel="stylesheet" href="style.css">
    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.3.1?dev",
                "react-dom": "https://esm.sh/react-dom@18.3.1?dev",
                "react-dom/client": "https://esm.sh/react-dom@18.3.1/client?dev",
                "react/jsx-runtime": "https://esm.sh/react@18.3.1/jsx-runtime?dev",
                "react/jsx-dev-runtime": "https://esm.sh/react@18.3.1/jsx-dev-runtime?dev",
                "remotion": "https://esm.sh/remotion@4.0.350?external=react,react-dom&dev",
                "@websim/remotion/player": "https://esm.websim.com/@websim/remotion/player",
                "@remotion/player": "https://esm.sh/@remotion/player@4.0.350?external=react,react-dom&dev"
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8/dist/hls.min.js"></script>
    <script type="module" src="recorder.jsx"></script>
    <script type="module" src="app.js"></script>
    <!-- User requested script for captioning functionality -->
    <script src="https://player.mediaklikk.hu/playernew/js/jwp8/jwplayer.js"></script>
</head>
<body>
    <header>
        <h1>Live TVz</h1>
        <nav id="main-nav">
            <button class="nav-button active" data-view="live-tv">Live TV</button>
            <button class="nav-button" data-view="recordings">Recordings</button>
            <button class="nav-button" data-view="captures">Captures</button>
            <button class="nav-button" data-view="settings">Settings</button>
        </nav>
    </header>
    <main id="main-content">
        <div id="live-tv-view" class="view active">
            <h2>Current Channels</h2>
            <div class="channel-list">
                <button class="channel-button focusable" data-channel-id="1" data-channel-url="https://c402-node61-cdn.connectmedia.hu/150106/70ab723615bc8a634a45a5aad84c39ab/68d99429/index.m3u8" data-channel-name="Duna World">
                    1. Duna World
                </button>
                <button class="channel-button focusable" data-channel-id="2" data-channel-url="https://c402-node61-cdn.connectmedia.hu/110101/a97828deb07e70d70b41d3032a7de1b2/68da2a2b/index.m3u8" data-channel-name="M1">
                    2. M1
                </button>
                <button class="channel-button focusable" data-channel-id="3" data-channel-url="https://c201-node61-cdn.connectmedia.hu/110102/2449392930b8d80b9a5e80c1a9be8b0e/68da2b55/index.m3u8" data-channel-name="M2">
                    3. M2
                </button>
                <button class="channel-button focusable" data-channel-id="4" data-channel-url="https://c201-node62-cdn.connectmedia.hu/150104/601bd25e6c88cddcca86c4ba45ec8927/68da9e5a/index.m3u8" data-channel-name="M4 Sport">
                    4. M4 Sport
                </button>
                <button class="channel-button focusable" data-channel-id="5" data-channel-url="https://c202-node62-cdn.connectmedia.hu/150108/b56fb5c15b2ae8656c345b9179797fe4/68da9f78/index.m3u8" data-channel-name="M4 Sport 2">
                    5. M4 Sport 2
                </button>
                <button class="channel-button focusable" data-channel-id="6" data-channel-url="https://c201-node62-cdn.connectmedia.hu/150109/e95304df4cb1ee757c003fe9b7a5c0fb/68daa00f/index.m3u8" data-channel-name="M4 Sport 3">
                    6. M4 Sport 3
                </button>
                <button class="channel-button focusable" data-channel-id="7" data-channel-url="https://c201-node61-cdn.connectmedia.hu/150110/323ab759df9f3e03809c580b8a485898/68daa076/index.m3u8" data-channel-name="M4 Sport 4">
                    7. M4 Sport 4
                </button>
                <button class="channel-button focusable" data-channel-id="8" data-channel-url="https://c402-node61-cdn.connectmedia.hu/150111/d73176fe0f6fe995c8a4f4da4b388b84/68daa0c8/index.m3u8" data-channel-name="M4 Sport 5">
                    8. M4 Sport 5
                </button>
            </div>
        </div>
        <div id="recordings-view" class="view hidden">
            <h2>Your Recordings</h2>
            <ul id="recordings-list">
                <!-- Recordings will be added here -->
            </ul>
            <p id="no-recordings" style="text-align: center;">No recordings yet. Hit 'Record' while watching TV!</p>
        </div>
        
        <div id="captures-view" class="view hidden">
            <h2>Your Captures (Screenshots)</h2>
            <ul id="captures-list">
                <!-- Captures will be added here -->
            </ul>
            <p id="no-captures" style="text-align: center;">No screenshots yet. Hit 'Capture' while watching TV!</p>
        </div>
        
        <div id="settings-view" class="view hidden">
            <h2>Settings</h2>
            <div class="settings-section">
                <h3>Appearance</h3>
                
                <div style="margin-bottom: 20px;">
                    <label for="language-select">Select Language:</label>
                    <select id="language-select" class="focusable">
                        <!-- Options will be populated via JS -->
                    </select>
                </div>

                <div style="margin-bottom: 20px;">
                    <label for="gui-scale-select">GUI Scale:</label>
                    <select id="gui-scale-select" class="focusable">
                        <option value="small">Small</option>
                        <option value="medium">Medium (Default)</option>
                        <option value="large">Large</option>
                    </select>
                </div>
                
                <label for="theme-select">Select Theme:</label>
                <select id="theme-select" class="focusable">
                    <option value="dark">Dark Theme (Default)</option>
                    <option value="light">Light Theme (Experimental)</option>
                </select>
                <button id="apply-theme-button" class="focusable">Apply Theme</button>
                
                <div style="margin-top: 20px;">
                    <label for="font-select">Select Font Family:</label>
                    <select id="font-select" class="focusable">
                        <option value="sans-serif">Sans Serif (Default)</option>
                        <option value="serif">Serif</option>
                        <option value="monospace">Monospace</option>
                        <option value="system-ui">System UI</option>
                    </select>
                </div>
            </div>

            <div class="settings-section" id="captions-style-section">
                <h3>Captions Style</h3>
                <div class="setting-group">
                    <label for="caption-font-select">Caption Font Family:</label>
                    <select id="caption-font-select" class="focusable">
                        <option value="sans-serif">Sans Serif (Default)</option>
                        <option value="serif">Serif</option>
                        <option value="monospace">Monospace</option>
                        <option value="system-ui">System UI</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label for="caption-size-select">Caption Size:</label>
                    <select id="caption-size-select" class="focusable">
                        <option value="small">Small</option>
                        <option value="medium">Medium (Default)</option>
                        <option value="large">Large</option>
                        <option value="extra-large">Extra Large</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label for="caption-position-select">Caption Position:</label>
                    <select id="caption-position-select" class="focusable">
                        <option value="bottom">Bottom (Default)</option>
                        <option value="center">Center</option>
                        <option value="top">Top</option>
                    </select>
                </div>

                <div class="setting-group">
                    <label for="caption-text-color-input">Text Color:</label>
                    <input type="color" id="caption-text-color-input" value="#ffffff" class="focusable">
                    
                    <label for="caption-text-transparency-input">Text Transparency:</label>
                    <input type="range" id="caption-text-transparency-input" min="0" max="100" value="100" class="focusable">
                    <span id="caption-text-transparency-display">100%</span>
                </div>
                
                <div class="setting-group">
                    <label for="caption-bg-color-input">Background Color:</label>
                    <input type="color" id="caption-bg-color-input" value="#000000" class="focusable">

                    <label for="caption-bg-transparency-input">Background Transparency:</label>
                    <input type="range" id="caption-bg-transparency-input" min="0" max="100" value="80" class="focusable">
                    <span id="caption-bg-transparency-display">80%</span>
                </div>
                
                <div class="setting-group">
                    <label for="caption-outline-select">Outline Style:</label>
                    <select id="caption-outline-select" class="focusable">
                        <option value="none">None</option>
                        <option value="solid">Solid Black</option>
                        <option value="thin">Thin White</option>
                        <option value="thick">Thick Yellow</option>
                    </select>
                </div>

                <div class="setting-group">
                    <label for="caption-shadow-select">Shadow/Glow Style:</label>
                    <select id="caption-shadow-select" class="focusable">
                        <option value="none">None</option>
                        <option value="raised">Raised Shadow</option>
                        <option value="depressed">Depressed Shadow</option>
                        <option value="glow">Soft Glow</option>
                    </select>
                </div>
            </div>

            <div class="settings-section">
                <h3>Button Customization</h3>
                <label for="button-color-display">Primary Button Color:</label>
                <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;">
                    <div id="button-color-display" style="width: 30px; height: 30px; border-radius: 50%; border: 2px solid white;"></div>
                    <button id="open-color-picker-button" class="focusable">Choose Color</button>
                </div>
            </div>

            <div class="settings-section">
                <h3>Live TV Quality & Recording</h3>
                <label for="live-tv-frames">Live TV Frames (FPS):</label>
                <select id="live-tv-frames" class="focusable" style="margin-bottom: 15px;">
                    <option value="20">20 FPS (Low)</option>
                    <option value="30">30 FPS (Default)</option>
                    <option value="60">60 FPS (High)</option>
                </select>
                
                <label for="live-tv-quality">Live TV Quality (Bitrate Mbps):</label>
                <select id="live-tv-quality" class="focusable" style="margin-bottom: 15px;">
                    <option value="5000000">5 Mbps (Standard)</option>
                    <option value="10000000">10 Mbps (HD Default)</option>
                    <option value="20000000">20 Mbps (High HD)</option>
                </select>
                
                <label for="recording-conversion">Recording Conversion Format:</label>
                <select id="recording-conversion" class="focusable">
                    <option value="mp4">MP4 (Default)</option>
                    <option value="webm">WebM</option>
                    <option value="avi">AVI</option>
                    <option value="mkv">MKV</option>
                    <option value="wmv">WMV</option>
                    <option value="mov">MOV</option>
                    <option value="mpeg">MPEG</option>
                    <option value="avchd">AVCHD</option>
                    <option value="flv">Flash Video (FLV)</option>
                    <option value="mpg">MPG</option>
                </select>
                
                <p style="margin-top: 15px;">Note: Quality/Frames affect recording settings. Conversion is simulated output format.</p>
            </div>
        </div>

        <!-- The main Guide view is removed from main-content, but kept here as a fallback view -->
        <div id="guide-view" class="view hidden">
            <!-- Content here will only be shown if accessed via main nav, which is less likely now -->
            <h2>Example Guide (Standalone)</h2>
            <p>Please access Guide via the player controls for the intended experience.</p>
        </div>

    </main>

    <div id="video-container" class="hidden">
        <video id="tv-player" controls></video>
        <img id="media-viewer-img" style="display: none; max-width: 100%; max-height: 100%; object-fit: contain;" alt="Capture viewer">
        
        <!-- Numerical Channel Selection UI -->
        <div id="channel-number-display" class="hidden"></div>
        
        <!-- Seek/DVR Overlay (New) -->
        <div id="seek-overlay" class="hidden">
            <div class="seek-preview-container">
                <!-- The video player itself provides the screen preview -->
                <div id="seek-time">00:00:00</div>
                <div id="seek-indicator"></div>
            </div>
            <div class="seek-progress-bar">
                <div id="seek-current-time">00:00:00</div>
                <div class="progress-bar-container">
                    <div id="progress-live-edge">Live</div>
                    <div id="progress-buffer"></div>
                    <div id="progress-seek-thumb"></div>
                </div>
                <div id="seek-live-time">Live</div>
            </div>
        </div>
        
        <!-- Recording Status Overlay (New) -->
        <div id="recording-status-overlay" class="hidden">
            <div class="recording-status-content">
                <div class="recording-indicator">
                    <span class="red-dot"></span>
                    <span class="status-text">Recording...</span>
                </div>
                <div id="recording-timestamp">00:00:00</div>
                <div class="recording-controls">
                    <button id="ui-record-pause" class="focusable">Pause</button>
                    <button id="ui-record-stop" class="focusable">Stop</button>
                </div>
            </div>
        </div>
        
        <!-- Guide Overlay -->
        <div id="guide-overlay" class="hidden">
            <div class="guide-header">
                <button id="guide-back-button" class="focusable">← Back to Live TV</button>
                <span id="guide-real-time-clock"></span>
            </div>
            <div class="guide-container">
                <div id="guide-channels" class="guide-sidebar">
                    <!-- Channel names will be injected here -->
                </div>
                <div id="guide-timeline" class="guide-content">
                    <!-- Program grid will be injected here -->
                </div>
            </div>
        </div>

        <div id="player-ui" class="hidden">
            <div class="ui-bar">
                <span id="ui-channel-name"></span>
                <div class="ui-controls">
                    <button id="ui-rewind-button" class="focusable">≪ 10s</button>
                    <button id="ui-play-pause-button" class="focusable">Pause</button>
                    <button id="ui-fast-forward-button" class="focusable">10s ≫</button>
                    <button id="ui-cc-button" class="focusable">CC Off</button>
                    <button id="ui-guide-button" class="focusable">Guide</button>
                    <button id="ui-record-button" class="focusable">Record</button>
                    <button id="ui-capture-button" class="focusable">Capture</button>
                    <button id="ui-stop-button" class="focusable">Exit</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Remotion Player Container for rendering recordings -->
    <div id="remotion-player-container" style="display: none;"></div>

    <!-- Custom Alert Modal -->
    <div id="custom-alert-modal" class="hidden">
        <div class="custom-alert-content">
            <p id="custom-alert-message"></p>
            <div id="custom-alert-buttons">
                <!-- Buttons injected here -->
            </div>
        </div>
    </div>
    
    <!-- Custom Color Picker Modal -->
    <div id="color-picker-modal" class="hidden">
        <div class="color-picker-content">
            <button id="color-picker-close-button" class="close-button focusable">X</button>
            <h3>Select Primary Color (Built-in Picker)</h3>
            <p>Choose a color for interactive elements.</p>
            <input type="color" id="html-color-input" value="#00bcd4">
            <div id="color-swatches">
                <div class="color-swatch focusable" data-color="#00bcd4" style="background-color: #00bcd4;"></div>
                <div class="color-swatch focusable" data-color="#1e88e5" style="background-color: #1e88e5;"></div>
                <div class="color-swatch focusable" data-color="#4caf50" style="background-color: #4caf50;"></div>
                <div class="color-swatch focusable" data-color="#ff9800" style="background-color: #ff9800;"></div>
                <div class="color-swatch focusable" data-color="#f44336" style="background-color: #f44336;"></div>
                <div class="color-swatch focusable" data-color="#9c27b0" style="background-color: #9c27b0;"></div>
            </div>
            <button id="apply-color-button" class="focusable">Apply Selected Color</button>
        </div>
    </div>
    
    <!-- WiFi File Transfer Modal -->
    <div id="p2p-transfer-modal" class="hidden">
        <div class="transfer-content">
            <button id="p2p-close-button" class="close-button focusable">X</button>
            <h3 id="transfer-header">Share Content</h3>
            <p id="transfer-message">Select content to share or enter a code to receive.</p>
            
            <div id="transfer-mode-selection">
                <button id="transfer-share-mode" class="focusable">Share Content</button>
                <button id="transfer-receive-mode" class="focusable">Receive Content</button>
            </div>
            
            <div id="transfer-share-ui" class="hidden">
                <h4>Select Item to Share:</h4>
                <select id="transfer-content-select">
                    <!-- Options injected here -->
                </select>
                <button id="transfer-generate-code" class="focusable">Generate Sharing Code</button>
                <p id="transfer-code-display" class="hidden">Code: <span id="sharing-code"></span></p>
                <p id="transfer-status-share"></p>
            </div>
            
            <div id="transfer-receive-ui" class="hidden">
                <h4>Enter Sharing Code:</h4>
                <input type="text" id="transfer-code-input" placeholder="e.g., A1B2C3" maxlength="6">
                <button id="transfer-start-receive" class="focusable">Receive</button>
                <p id="transfer-status-receive"></p>
            </div>
        </div>
    </div>
    
    <!-- Notification Popup -->
    <div id="notification-popup" class="hidden notification-hidden">
        <p id="notification-message">Notification</p>
    </div>
</body>
</html>